# Changelog

## [Latest] - 2025-10-27

### Changed

#### Default User Status

**What Changed:**

- New users automatically receive `status: "works"` if not explicitly provided
- Previously: `status` was `null` when not provided
- Now: `status` defaults to `"works"`

**Why:**
Most users are active/working when first created. This provides a sensible default.

**Examples:**

```typescript
// Create user without status
POST /api/users
{
  "firstName": "Jane",
  "lastName": "Doe",
  "contacts": { "email": "jane@example.com" }
}
// Response: { "id": 11, "status": "works", ... } ← Automatically set!

// Create user with explicit status
POST /api/users
{
  "firstName": "Bob",
  "lastName": "Smith",
  "status": "vacation"
}
// Response: { "id": 12, "status": "vacation", ... } ← Uses provided value
```

**Files Modified:**

- `src/services/users.service.ts` - Added default status in create method

#### Sequential Auto-Incrementing IDs

**What Changed:**

- All entity IDs are now sequential numbers (1, 2, 3...) instead of timestamp-based strings
- Database uses `INTEGER PRIMARY KEY AUTOINCREMENT` for all tables
- IDs are automatically generated by the database

**Before:**

```typescript
id: string; // "1761570819146"
```

**After:**

```typescript
id: number; // 1, 2, 3, etc.
```

**Benefits:**

- ✅ Cleaner, more readable IDs
- ✅ Smaller data size
- ✅ Better performance for indexing
- ✅ Standard database practice
- ✅ Sequential and predictable

**Examples:**

```typescript
// Create user - ID auto-generated
POST /api/users
{
  "firstName": "John",
  "lastName": "Doe"
}
// Response: { "id": 11, ... }

// Get user by numeric ID
GET /api/users/1
// Response: { "id": 1, "firstName": "Roland", ... }
```

**Files Modified:**

- `src/types/index.ts` - Updated BaseEntity and Row interfaces
- `src/models/interfaces/base-entity.ts` - Changed ID type to number
- `src/database/database.ts` - Updated schema with AUTOINCREMENT
- `src/database/seed.ts` - Removed manual ID assignment
- `src/services/*.service.ts` - Updated all 4 services to use number IDs
- `src/routes/*.routes.ts` - Added parseInt() for route parameters

**Backward Compatibility:**

- ⚠️ Breaking change for existing data
- Database must be recreated (old database.db deleted)
- API accepts numeric IDs in URL parameters

#### User Project Field - Nullable Support

**What Changed:**

- The `project` field in the `User` interface now supports `Partial<Project> | null`
- Previously: `project: Pick<Project, 'id' | 'title'>`
- Now: `project: Partial<Project> | null`

**Why:**
This change allows users to be created without being assigned to a project. The project field can now be:

1. `null` - User has no project assignment
2. Partial project object - Can include any combination of project fields

**Examples:**

```typescript
// Create user without project
POST /api/users
{
  "firstName": "Jane",
  "lastName": "Smith",
  "contacts": {
    "email": "jane@example.com"
  }
}
// Response: project = null

// Create user with project
POST /api/users
{
  "firstName": "Bob",
  "lastName": "Johnson",
  "contacts": {
    "email": "bob@example.com"
  },
  "project": {
    "id": "1",
    "title": "UAN-DRT"
  }
}
// Response: project = { id: "1", title: "UAN-DRT" }

// Update user to remove project
PATCH /api/users/123
{
  "project": null
}
// Response: project = null
```

**Files Modified:**

- `src/types/index.ts` - Updated User interface
- `src/models/interfaces/user/user.interface.ts` - Updated User interface
- `src/services/users.service.ts` - Updated create, update, and rowToUser methods
- `README.md` - Updated documentation

**Backward Compatibility:**

- ✅ Existing users with projects continue to work
- ✅ API responses remain compatible
- ✅ Only affects new users created without projects

### Added

#### API Prefix Support

**What Changed:**

- All API endpoints now include `/api` prefix
- Old: `/users`, `/projects`, etc.
- New: `/api/users`, `/api/projects`, etc.

**Benefits:**

- Better separation between frontend and backend
- Standard REST API convention
- Easier integration with frontend applications on same host

**All Endpoints:**

```
GET    /api/users
GET    /api/users/summary
GET    /api/users/:id
POST   /api/users
PATCH  /api/users/:id
DELETE /api/users/:id

GET    /api/projects
GET    /api/projects/summary
GET    /api/projects/:id
POST   /api/projects
PATCH  /api/projects/:id
DELETE /api/projects/:id

GET    /api/equipment
GET    /api/equipment/summary
GET    /api/equipment/:id
POST   /api/equipment
PATCH  /api/equipment/:id
DELETE /api/equipment/:id

GET    /api/vacations
GET    /api/vacations/:id
POST   /api/vacations
PATCH  /api/vacations/:id
DELETE /api/vacations/:id
```

### Fixed

#### TypeScript Path Aliases

**What Changed:**

- Added `tsconfig-paths` package for proper path alias resolution
- Renamed `@types/*` to `@app-types/*` to avoid conflicts
- Updated all imports to use correct aliases

**Path Aliases:**

- `@database/*` - Database layer
- `@models/*` - Data models
- `@mocks/*` - Mock data
- `@routes/*` - API routes
- `@services/*` - Business logic
- `@app-types/*` - Type definitions (renamed from @types/\*)

## Previous Changes

See individual documentation files:

- `STRUCTURE_CHANGES.md` - Project reorganization
- `IMPROVEMENTS.md` - Architecture improvements
- `ARCHITECTURE.md` - Architecture details
